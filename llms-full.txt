# Health360: Weight & Anti-Age repository map (llms-full)

Purpose
- Provide a comprehensive map of app features, screens, services, and backend functions for LLM context.
- Generated from repository state in c:\Users\annah\Documents\HE360.

Repo structure and apps
- Mobile + web app (Expo React Native) in /src
- Firebase Cloud Functions in /functions (TypeScript compiled to /functions/lib)
- MCP server for ChatGPT integration in /mcp-server (Express + MCP SDK)
- Web export output in /web-build (generated)
- Native platform folders: /android, /ios (generated by Expo prebuild)

Entrypoints and config
- App entry: App.tsx
- Navigation: src/navigation/AppNavigator.tsx, src/navigation/BottomTabNavigator.tsx
- Expo config: app.json
- Metro config: metro.config.js
- Babel config: babel.config.js
- TypeScript config: tsconfig.json
- Firebase hosting/functions config: firebase.json, storage.rules
- EAS config: eas.json

Navigation overview
- Auth flow (stack): Welcome -> Auth -> ForgotPassword
- Post-auth landing: HelloScreen
- Main tabs (BottomTabNavigator): HomeTab, ProgressTab, AchievementsTab, ProfileTab
  - HomeTab stack: Today, Dashboard, WaterIntake, Sleep, SleepTracking, Movement, MealPlan, FoodCombination,
    BodyCheck Wizard/Results, Lifestyle Wizard/Results, ActivityWizard, WeightProgress, Mood, SavedShoppingLists
  - ProgressTab: ProgressScreen
  - AchievementsTab: AchievementsScreen
  - ProfileTab: ProfileScreen + Support + AIChat
- Root stack includes most feature screens for meal plans, assessments, modules, settings, and utilities.

Screens (by folder)
- src/screens (top-level)
  AchievementsScreen, ActivityWizardScreen, AIChatScreen, AIMealPlanScreen, AntiAgeDashboardScreen,
  AntistressAdviceScreen, AuthScreen, BodyCheckResultsScreen, BodyCheckWizardScreen, BodyCheckWizardWrapper,
  BreakfastRecipesScreen, ChallengeDailyScreen, ChallengesScreen, CitationsScreen, CommunityScreen, CoursesScreen,
  DailyCheckInScreen (empty), DashboardScreen, DetoxAdviceScreen, DiabetesScreen, DinnerRecipesScreen,
  EnhancedShoppingListScreen, FilteredRecipesScreen, FoodCombinationScreen, FoodDiaryScreen, FoodScanScreen,
  ForgotPasswordScreen, GIScreen, GutScreen, HealthSyncScreen, HelloScreen, HolidayMealsScreen,
  HolidayPlanningScreen, HolidayRecoveryScreen, HolidayTipsScreen, HormonalLearningScreen, HormoneDetailScreen,
  HormoneInfoScreen, HormoneScreen, HormonesScreen, LabResultsAnalysisScreen, LabResultsFormScreen, LabsGuideScreen,
  LifestyleResultsScreen, LifestyleWizardScreen, LunchRecipesScreen, MealPlanHeader (empty), MealPlanScreen,
  MoodScreen, MovementScreen, NotificationOptInScreen, NotificationSettingsScreen,
  NutritionalInsightsDashboardScreen, OllamaSetupScreen, PersonalizedRecipesScreen, PrivacyPolicyScreen,
  ProfileScreen, ProgressScreen, RecipeDetailScreen, SavedShoppingListsScreen, ScanScreen, SecondBreakfastScreen,
  SettingsScreen, SleepScreen, SleepTrackingScreen, SmartRecipeFilterScreen, SnackRecipesScreen, SubscriptionScreen,
  SupplementDetailScreen (empty), SupplementsScreen, SupportScreen, SymptomAnalysisScreen, SymptomsScreen,
  TermsOfServiceScreen, TodayScreen, UniversalMealPlan, UniversalMealPlanScreen, WaterIntakeScreen,
  WeeklyMealPlanGeneratorScreen, WeeklyReviewScreen, WeightLossShoppingListScreen, WeightProgressScreen,
  WelcomeScreen

- src/screens/detox
  DetoxEducationScreen, DetoxPhaseScreen, DetoxProgressScreen, OrganMealPlanScreen, OrganSupportScreen

- src/screens/mealPlans
  DetoxMealPlanScreen, HealthyEatingMealPlanScreen, IllnessMealPlanScreen, LentenMealPlanScreen,
  PaleoMealPlanScreen, PlateConstructorScreen, VeganMealPlanScreen, VegetarianMealPlanScreen,
  WeightLossMealPlanScreen, WeightLossVegetarianMealPlanScreen

- src/screens/modules
  AlkalineDietScreen, AntiAgeCheckupScreen, AntiAgeDietScreen, AntiAgePracticesScreen,
  MediterraneanDietScreen, OncologyScreen, YouthSkinScreen

- src/screens/onboarding
  OnboardingFirstActionScreen, OnboardingHabitSelectionScreen, OnboardingHealthAssessmentScreen,
  OnboardingNavigator, OnboardingNotificationScreen, OnboardingProfileScreen, OnboardingTutorialScreen,
  OnboardingTypes, OnboardingWelcomeScreen

- src/screens/habits
  HabitsOverviewScreen

Components (high-level groups)
- src/components subfolders: achievements, ads, assessments, bodycheck, common, dashboard, lifestyle, modals,
  movement, onboarding, profile, progress, scanner, shared, subscription
- Additional shared components: ChallengeCard, ErrorBoundary, FoodAnalysis* components, MealAnalysisSection,
  MissingIngredientDetection, NutritionSummaryCard, PrimaryButton, UserFeedbackSystem, etc.

State + context
- src/context: AuthContext, UserContext, ProfileContext, SubscriptionContext, LanguageContext, SettingsContext,
  AchievementContext, ChallengeContext, DailyTaskContext, GoalsContext, MovementContext, SleepContext,
  MicroHabitsContext, OnboardingProgressContext, OnboardingNewContext, SevenDayPlanContext, FlagsContext,
  GuaranteeContext

Hooks
- src/hooks: useAuth, useFoodAnalysisAnalytics, useFoodAnalysisPreferences, useHealthData, useMealPlanConversion,
  usePointsAndAchievements, useQdrantFoodClassification, useSubscriptionGuard

Services (business logic)
- Achievement: achievementService, achievementTracker, pointsService
- Anti-age: AntiAgeService
- Body check: BodyCheckPlanService, bodyCheckService (firebase)
- Food analysis: FoodAnalysisService, EnhancedFoodAnalysisService, EnhancedFoodDetectionService,
  FoodGroupClassificationService, NutritionLabelsService, NutritionalDatabase, FoodAnalysisAnalyticsService,
  FoodAnalysisPerformanceMonitor, FoodAnalysisPreferencesService
- AI + OpenAI: OpenAIAssistantsService, OpenAIFoodClassificationService, OpenAIFoodDetectionService,
  OpenAIGlycemicLookupService, OpenAIMedicalAssistantService
- Qdrant: QdrantFoodClassificationService, QdrantFoodService, QdrantIngredientCatalog,
  QdrantLifestyleInsightsService
- Meal plans + shopping: MealPlanIntegrationService, ShoppingListService, WeightLossShoppingListService
- Health data + progress: HealthDataService, ProgressDataService, goalFollowups
- Labs: LabResultsService
- Notifications: NotificationService (retentionNotificationService placeholder)
- Skin analysis: SkinAnalysisService
- Supplements: SupplementSearchService
- Daily/weekly: dailyTaskTracker, weeklyReview
- PromptService, IngredientTranslationService, ErrorHandlingService
- Placeholders (empty files): dailyCheckInService, onboardingProgressService, onboardingTracker,
  retentionNotificationService

API clients
- src/api/aiService.ts: AI router that prefers Ollama, falls back to OpenAI, then local responses
- src/api/ollama.ts: Local Ollama HTTP client
- src/api/openai.ts: Firebase callable wrapper (analyzeSymptoms)
- src/api/network.ts: safeApiCall helpers with retry

Firebase integration (client)
- Firebase config: src/firebase/config.ts, firebase.native.ts, firebase.web.ts
- Auth: auth.ts, auth.native.ts, auth.web.ts, googleAuthHelper.ts
- Firestore services: profileService, enhancedProfileService, bodyCheckService, labResultsService,
  labsGuideService, mealPlans, challenges, metrics, supplementService, adviceService, antistressAdviceService
- Storage: initialized in config.ts

Firestore collections (observed in client code)
- users/{uid}/health_metrics
- users/{uid}/weight_entries
- users/{uid}/daily_progress
- users/{uid}/food_entries
- users/{uid}/enhanced_shopping_lists
- users/{uid}/meal_plans
- users/{uid}/weekly_meal_plans
- users/{uid}/lifestyle_results
- users/{uid}/body_check_results
- community_posts (+ likes, comments subcollections)
- lifestyle_assessments
- bodyChecks
- labResults
- mealPlans
- labsGuide
- supplements
- advices
- antistressAdvice
- challenges, challengeProgress
- metrics/{uid}/achievement_events
- health_progress

Cloud Functions (Firebase, functions/src/index.ts)
- analyzeLifestyleQdrantCall (onCall) - lifestyle assessment analysis via OpenAI + Qdrant
- analyzeLifestyleQdrant (onRequest) - HTTP version of lifestyle analysis
- medicalAssistantCall (onCall) - medical assistant response via OpenAI
- createCheckoutSession (onCall) - Stripe checkout session (monthly/quarterly/annual)
- verifySubscription (onCall) - Stripe subscription verification
- createCustomerPortal (onCall) - Stripe customer portal link
- verifyAppleReceipt (onCall) - Apple IAP receipt validation
- stripeWebhook (onRequest) - Stripe webhook + GA4 server-side tracking
- deleteAccount (onCall) - account + billing cleanup
- classifyFoodQdrant (onRequest) - food classification using Qdrant + OpenAI embeddings
- classifyFoodQdrantCall (onCall) - callable wrapper of classifyFoodQdrant
- searchSupplementsQdrant (onRequest) - supplement search via Qdrant
- searchSupplementsQdrantCall (onCall) - callable wrapper of supplement search
- submitFeedbackEmail (onRequest) - email feedback (SMTP)
- sendFoodFeedbackEmail (onCall) - callable wrapper for feedback email
- recordFoodDetectionFeedback (onCall) - log feedback to Firestore
- analyzeMealPhoto (onCall) - meal photo analysis via OpenAI
- analyzeMealPhotoHttp (onRequest) - HTTP version
- askHttp (onRequest) - generic OpenAI text completion endpoint
- analyzeSkin (onCall) - skin analysis via OpenAI
- helper: functions/src/keywordClassification.ts for keyword-based food group fallback

Callable Functions referenced by client code (firebase/functions)
- analyzeMealPhoto
- analyzeSkin
- analyzeSymptoms (not found in functions/src/index.ts; likely legacy)
- cancelSubscription (not found in functions/src/index.ts; likely legacy)
- createCheckoutSession
- createCustomerPortal
- deleteAccount
- getSubscriptionAnalytics (not found in functions/src/index.ts; likely legacy)
- medicalAssistantCall
- resumeSubscription (not found in functions/src/index.ts; likely legacy)
- searchSupplementsQdrantCall
- verifyAppleReceipt
- verifySubscription
- classifyFoodQdrantCall

MCP server (mcp-server/src/index.ts)
- Express + MCP SDK with OAuth (authorization code + PKCE) and Firebase Auth login page
- OAuth endpoints
  - GET /health
  - GET /.well-known/oauth-authorization-server
  - GET /.well-known/oauth-protected-resource
  - GET /.well-known/oauth-protected-resource/sse
  - GET /oauth/authorize (renders login + consent page)
  - POST /oauth/exchange (exchange Firebase ID token for auth code)
  - POST /oauth/token (code -> access + refresh tokens)
- MCP SSE transport: GET /sse, POST /messages
- MCP resource: health360://app-preview
- MCP tools
  - health360.get_profile
  - health360.get_latest_lifestyle_assessment
  - health360.get_latest_lab_results
  - health360.list_lab_results
  - health360.list_meal_plans
  - health360.list_daily_progress
  - health360.list_health_metrics
  - health360.list_weight_entries
  - health360.get_progress_goals
  - health360.get_health_snapshot
  - health360.get_app_preview
  - health360.create_handoff_link

Models + types
- src/models: Activity, Challenge, DisplayAchievement, Food, HealthMetrics, MealPlan, User
- src/types: ActivityWizardTypes, DetoxTypes, FoodClassificationTypes, HealthAssessmentTypes,
  IngredientTranslationTypes, LabResultTypes, subscription, plus ambient typings

Utils (selected)
- healthRiskAnalysis.ts, healthDataValidation.ts, healthTips.ts, ActivityRecommendations.ts
- translation and ingredient helpers: ingredientParser, ingredientConversion, ingredientTranslationUtils,
  instructionTranslation, mealTranslationUtils, translationUtils
- meal planning helpers: mealPlanningUtils, foodCombination, sideDishSlug
- navigation helpers: goToSubscription, goToToday, subscriptionReturn
- analytics helpers: analytics.ts
- platform/web shims: webAsyncStorage, webBottomTabsStub, webNavigationStub, webVectorIcons, pointerEventsShim
- misc: sanitizeUnicode, unitConversion, validation, shadowStyles

Data + content
- src/data: meal plans, organ plans, prompts, supplements, localized content, health tips, glycemic index data,
  detox programs, anti-age content, citations
- src/i18n/locales: translation JSONs

Tests
- Jest config: jest.config.js, setupTests.ts
- Tests in src/__tests__ and service/utils __tests__ folders

Build and deploy scripts
- package.json scripts (expo start, build:web, deploy, functions:build/deploy, etc.)
- functions/package.json build/deploy
- mcp-server/package.json build/dev/start

Known placeholders or empty files
- src/screens/DailyCheckInScreen.tsx
- src/screens/MealPlanHeader.tsx
- src/screens/SupplementDetailScreen.tsx
- src/services/dailyCheckInService.ts
- src/services/onboardingProgressService.ts
- src/services/onboardingTracker.ts
- src/services/retentionNotificationService.ts
